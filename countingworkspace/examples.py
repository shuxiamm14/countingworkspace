import numpy as np

XSECTION_HIGGS_TOTAL = {'GGH': 48.52, 'VBF': 3.779, 'WH': 1.369, 'ZH': 0.8824, 'BBH': 0.4863, 'TTH': 0.5065, 'GGZH': 0.1227}


NCATEGORIES = 29
NPROCESS = 4
LUMI = 79.9  # /fb
EXPECTED_BKG_CAT = np.array(
    [
        13000,
        46000,
        19000,
        6900,
        640,
        80,
        7700,
        4100,
        690,
        61,
        280,
        35,
        690,
        320,
        470,
        110,
        610,
        9.8,
        6.5,
        95,
        5.3,
        2.6,
        55,
        33,
        8.2,
        1.4,
        4.7,
        4.9,
        2.2,
    ]
)

XSECFID_X_BR_PRODUCTION_MODES = np.array([101.5, 7.99, 4.53, 1.33])  # fb for |y| < 2.5
NTRUE = XSECFID_X_BR_PRODUCTION_MODES * LUMI

EFFICIENCIES_CAT_PRODUCTIONMODE = np.array(
    [
        [8.44062260e-02, 1.16227364e-02, 1.61568737e-02, 2.21471081e-04],
        [1.48438055e-01, 2.25251625e-02, 3.34504964e-02, 5.16342535e-04],
        [7.03025018e-02, 5.48094329e-02, 4.55980273e-02, 1.79441904e-03],
        [3.40335068e-02, 6.04452130e-02, 4.00562096e-02, 1.94788412e-03],
        [6.44775164e-03, 1.91181543e-02, 1.21023871e-02, 8.37050522e-04],
        [1.63443080e-03, 5.66171925e-03, 3.61359292e-03, 3.15114144e-04],
        [1.82444815e-02, 2.60907985e-02, 3.63153945e-02, 2.22397786e-02],
        [1.47371599e-02, 2.95007997e-02, 3.28717953e-02, 2.28440668e-02],
        [6.01598386e-03, 1.28199282e-02, 1.49638079e-02, 9.39107884e-03],
        [1.47773364e-03, 2.51609796e-03, 4.10525618e-03, 3.15075368e-03],
        [1.75964497e-03, 4.19176733e-02, 7.92689640e-04, 6.44170371e-04],
        [4.57390154e-04, 3.99063912e-02, 1.69339063e-04, 4.46022196e-04],
        [3.36384473e-03, 1.37667073e-02, 4.34326254e-03, 4.32904318e-03],
        [2.73503896e-03, 3.38346337e-02, 3.38377223e-03, 7.51175640e-03],
        [2.84039922e-03, 2.82836547e-03, 2.45596744e-02, 4.92609509e-03],
        [1.64421768e-03, 1.42465816e-03, 2.98544652e-02, 3.23415637e-03],
        [2.96175128e-03, 1.81893331e-02, 1.36502193e-02, 1.64941219e-02],
        [2.85601233e-05, 2.39438347e-05, 3.26981834e-03, 8.72434853e-05],
        [4.00076269e-06, 5.98595867e-06, 6.99679950e-03, 1.37593074e-03],
        [1.56610555e-04, 1.88557698e-04, 2.67914297e-02, 1.25997600e-02],
        [0.00000000e00, 2.99297934e-06, 7.08503133e-03, 4.87655802e-03],
        [0.00000000e00, 0.00000000e00, 4.97653608e-03, 2.24815038e-04],
        [2.06116500e-04, 3.83101355e-04, 2.77824215e-03, 3.74897217e-02],
        [1.14597907e-04, 1.64613864e-04, 1.71443422e-03, 5.48209404e-02],
        [3.43732284e-05, 4.78876694e-05, 5.70120190e-04, 3.87107900e-02],
        [1.77763028e-05, 2.59391543e-05, 3.94666075e-04, 4.71152975e-02],
        [1.10770251e-06, 1.99531956e-06, 3.11618505e-04, 1.08863584e-02],
        [0.00000000e00, 9.97659779e-07, 2.27969899e-04, 2.62151681e-02],
        [0.00000000e00, 0.00000000e00, 1.34483704e-04, 5.06637263e-02],
    ]
)

EFFICIENCIES = EFFICIENCIES_CAT_PRODUCTIONMODE * 0.9

NAMES_PROC = ['ggF', 'VBF', 'VH', 'TOP']


### ttHyy 140/fb ATLAS-CONF-2019-004
ATLAS_CONF_2019_004 = {
    "LUMI": 138.97,  # fb
    "NPROCESS": 9,
    "PROCESS_NAMES": ['TTH', 'THJB', 'TWH', 'GGH', 'VBF', 'WH', 'ZH', 'GGZH', 'BBH'],
    "NTRUE": LUMI * BR * np.array([XSECTION_HIGGS_TOTAL[p] for p in PROCESS_NAMES]),
    "NCATEGORIES": 7,
    "CAT_NAMES": ['LEP1', 'LEP2', 'LEP3', 'HAD1', 'HAD2', 'HAD3', 'HAD4'],
    "EFFICIENCIES": [
        [0.0342, 0.0253, 0.0306, 1.6E−4, 3.0E−4, 0.0012, 0.0029, 0.0084, 0.0011],
        [0.0537, 0.0173, 0.0470, 8.9E−5, 1.4E−4, 6.8E−4, 0.0017, 0.00615, 5.9E−4],
        [0.0387, 0.0073, 0.0351, 2.7E−5, 4.2E−5, 2.3E−4, 6.1E−4, 0.00225, 1.9E−4],
        [0.0482, 0.0049, 0.0544, 1.5E−5, 1.8E−5, 1.5E−4, 3.8E−4, 0.00157, 9.1E−5],
        [0.0101, 0.0126, 0.0116, 5.0E−7, 1.2E−6, 2.6E−4, 1.8E−4, 3.7E−4, 9.8E−6],
        [0.0273, 0.0092, 0.0256, 2.1E−7, 6.6E−7, 2.0E−4, 1.1E−4, 2.5E−4, 8.3E−6],
        [0.0549, 0.0053, 0.0546, 2.3E−7, 3.8E−7, 1.1E−4, 6.5E−5, 2.2E−4, 0],
        ]
    "EXPECTED_BKG" = [4.6, 7.5, 7.5, 4.5, 16.5, 56.0, 101],  # in 90% window
    "EXPECTED_BKG_HIGGS" = [0.42, 0.43, 0.49, 0.8, 1.1, 3.1, 5]
}

ATLAS_CONF_2019_004_SIMPLIFIED = {
    "LUMI": 138.97,  # fb
    "NPROCESS": 1,
    "NTRUE": LUMI * BR * XSECTION_HIGGS_TOTAL['TTH'],
    "NCATEGORIES": 7,
    "CAT_NAMES": ['LEP1', 'LEP2', 'LEP3', 'HAD1', 'HAD2', 'HAD3', 'HAD4'],
    "EFFICIENCIES": [
        [0.0342],
        [0.0537],
        [0.0387],
        [0.0482],
        [0.0101],
        [0.0273],
        [0.0549],
        ]
    "EXPECTED_BKG" = [4.6 + 0.42, 7.5 + 0.43, 7.5 + 0.49, 4.5 + 0.8, 16.5 + 1.1, 56.0 + 3.1, 101 + 5],  # in 90% window
}
